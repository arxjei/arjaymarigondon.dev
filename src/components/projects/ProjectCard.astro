---
import { CalendarPlus, GitPullRequestDraft, MoveRight } from "lucide-astro";
import BrutalCard from "@components/BrutalCard.astro";
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import BrutalButton from "@components/BrutalButton.astro";
import BrutalPill from "@components/BrutalPill.astro";

interface Props {
	project: CollectionEntry<"projects">;
}

const { project } = Astro.props;
const { default: techStack } = await import("@data/misc/tech-stack.json");
---

<div
	class="w-full sm:w-[calc(50%-1rem)] lg:w-[calc(33.333%-1.334rem)] xl:w-[calc(25%-1.5rem)]">
</div>

<BrutalCard class="border-2 border-black">
	<Fragment slot="header">
		<h3 class="poppins text-md line-clamp-1">
			{project.data.title}
		</h3>
		{
			project.data.draft && (
				<BrutalPill
					class="!bg-lime-400 flex items-center gap-2"
					hoverable={false}
					tooltip="Save as Draft">
					<GitPullRequestDraft
						size={18}
						strokeWidth={2.5}
					/>
					Draft
				</BrutalPill>
			)
		}
	</Fragment>

	<div class="!p-4">
		<div class="border-3 border-black my-4 h-56 !p-4">
			<Image
				src={project.data.imgUrl}
				alt={project.data.title}
				width={800}
				height={400}
				class="rounded h-full w-full object-cover"
			/>
			{
				project.data.viewLiveDemoLink && (
					<div class="absolute -top-4 right-4">
						<BrutalPill
							class="!bg-lime-400"
							hoverable={false}>
							Demo Available!
						</BrutalPill>
					</div>
				)
			}
		</div>
		<p class="poppins">{project.data.description}</p>
		<div class="flex justify-end my-4">
			<BrutalButton
				href={`/projects/${project.id}/`}
				class="!flex items-center gap-2">
				Read more <MoveRight
					size={18}
					strokeWidth={2.5}
				/>
			</BrutalButton>
		</div>

		<div class="hidden sm:inline-block">
			<p class="poppins t-2">tags:</p>
			<div class="flex justify-between items-center">
				<ul class="flex flex-wrap gap-4 mt-2">
					{
						project.data.tags.slice(0, 6).map((tag) => {
							return (
								<li>
									<a
										class="sanchez"
										href={`/projects/tags/${tag.toLowerCase()}/`}>
										{(() => {
											const tech = techStack.find((t) => t.id === tag);

											return tech ? (
												<BrutalPill
													color={tech.color}
													class="flex justify-center items-center gap-2">
													<i class={tech.logo} />
													{tech.name}
												</BrutalPill>
											) : (
												<BrutalPill class="poppins">{tag}</BrutalPill>
											);
										})()}
									</a>
								</li>
							);
						})
					}
					{
						project.data.tags.length > 6 && (
							<li>
								<BrutalPill class="poppins">
									+{project.data.tags.length - 6}
								</BrutalPill>
							</li>
						)
					}
				</ul>
			</div>
		</div>
	</div>

	<Fragment slot="footer">
		<div class="flex items-center justify-between gap-2">
			<CalendarPlus
				size={18}
				strokeWidth={2.5}
			/>
			<div class="poppins text-sm text-black">
				{
					project.data.pubDate.toLocaleDateString("en-US", {
						year: "numeric",
						month: "long",
						day: "numeric",
						timeZone: "Asia/Manila",
						hour12: true,
						hour: "numeric",
						minute: "numeric",
					})
				}
			</div>
		</div>
	</Fragment>
</BrutalCard>
